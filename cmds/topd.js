const Discord = require('discord.js');
const fs = require('fs');
const derabbit = require('../package.json');
const config = require('../botconfig.json');
//mongoose
const mongoose = require('mongoose');
const profileModel = require('../schemas/profileSchema.js');
const dailyModel = require('../schemas/dailySchema.js');

module.exports.run = async (bot,message,args) => {
    try{
        
        let rUser = message.author;

        if (message.channel.id == config.mainChannel || message.channel.id == config.toxicChannel || message.channel.id == config.selfiesChannel) {
            bot.channels.cache.get(config.floodChannel).send(`–ï—â—ë —Ä–∞–∑ –ø—Ä–∏–≤–µ—Ç, ${rUser}! –¢—ã –Ω–µ –º–æ–∂–µ—à—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤ –æ–±—â–∏–µ —á–∞—Ç—ã –¥–ª—è –æ–±—â–µ–Ω–∏—è! –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å —á–∞—Ç <#${config.floodChannel}>!`);
            message.delete();
            return;
        }

        const results = await dailyModel.find({}).sort({dailysget: -1}).limit(10);

        var lbString = "";
        var lbPos = 1;
        var lbEmoji = ""

        for (let i = 0; i < results.length; i++) {
            const { userID, dailysget = 0 } = results[i];

            switch (lbPos) {
            case 1:
                lbEmoji = "ü•á"
                break;
            case 2:
                lbEmoji = "ü•à"
                break;
            case 3:
                lbEmoji = "ü•â"
                break;
            default:
                lbEmoji = ""
                break;
            }
            if (lbPos <= 3) {
                lbString += lbEmoji + ` <@${userID}>\n–†–∞–∑ –ø–æ–¥—Ä—è–¥: ` + dailysget + `\n\n`;
            } else {
                lbString += lbPos + ". " + ` <@${userID}>\n–†–∞–∑ –ø–æ–¥—Ä—è–¥: ` + dailysget + "\n\n";
            }
            lbPos++;
        }

        var lbEmbed = new Discord.MessageEmbed()
        .setColor(config.defaultColor)
        .setTitle("‚∏ù‚∏ù ‚ô°‚ÇäÀö –¢–æ–ø –ø–æ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–º –Ω–∞–≥—Ä–∞–¥–∞–º‚óû")
        .setDescription("```–¢–æ–ø 10 —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞–≥—Ä–∞–¥:```\n" + lbString)
        .setFooter(`${rUser.username}`, `${rUser.displayAvatarURL({dynamic: true})}`)
        .setTimestamp();
        message.channel.send(lbEmbed);

    } catch(err) {
        if(err.name === "ReferenceError")
        console.log("–£ –≤–∞—Å –æ—à–∏–±–∫–∞")
        console.log(`1.${err.name}\n2.${err.message}\n3.${err.stack}`);
    }
};

module.exports.help = {
    name: "topd",
    alias: "topdaily"
};